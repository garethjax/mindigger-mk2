---
import DashboardLayout from "@/layouts/DashboardLayout.astro";
import SwotForm from "@/components/dashboard/SwotForm";
import { createSupabaseServer } from "@/lib/supabase";

const supabase = createSupabaseServer(Astro.cookies, Astro.request);
const profile = Astro.locals.profile;
const businessId = profile?.business_id;

const { data: locations } = businessId
  ? await supabase
      .from("locations")
      .select("id, name, business_id, business_sector_id, is_competitor")
      .eq("business_id", businessId)
      .order("name")
  : { data: [] };
---

<DashboardLayout title="Nuova Analisi SWOT">
  <h1 class="mb-6 text-2xl font-bold">Nuova Analisi SWOT</h1>
  <SwotForm client:load locations={locations ?? []} />
</DashboardLayout>
