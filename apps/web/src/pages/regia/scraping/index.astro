---
import AdminLayout from "@/layouts/AdminLayout.astro";
import ScrapingDashboard from "@/components/admin/ScrapingDashboard";
import { createSupabaseServer } from "@/lib/supabase";

const supabase = createSupabaseServer(Astro.cookies, Astro.request);

// Fetch all scraping configs with location + business info
const { data: configs } = await supabase
  .from("scraping_configs")
  .select(`
    id, platform, status, bot_id, initial_scrape_done,
    initial_depth, recurring_depth, frequency,
    retry_count, last_error, last_scraped_at, next_poll_at, updated_at,
    locations(id, name, is_competitor, businesses(id, name))
  `)
  .order("updated_at", { ascending: false });

---

<AdminLayout title="Scraping">
  <h1 class="mb-6 text-2xl font-bold">Status Scraping</h1>
  <ScrapingDashboard
    client:load
    configs={(configs ?? []) as any}
    profileMap={{}}
  />
</AdminLayout>
